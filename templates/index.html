<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jute Leaf Disease Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-emerald-100 min-h-screen flex flex-col items-center justify-center text-gray-800">

    <div class="container mx-auto px-4 py-8 max-w-2xl">
        
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-emerald-800 mb-2">ðŸŒ¿ Jute Leaf Detector</h1>
            <p class="text-lg text-emerald-600">AI-Powered Disease Detection System</p>
        </div>

        <!-- Main Card -->
        <div class="glass rounded-3xl shadow-2xl p-8 md:p-10 bg-white/80">
            
            <!-- Upload Area -->
            <div id="drop-zone" class="border-3 border-dashed border-emerald-300 rounded-2xl p-8 text-center cursor-pointer hover:bg-emerald-50 transition-colors duration-300 relative group">
                <input type="file" id="file-input" class="hidden" accept="image/*">
                
                <div id="upload-prompt" class="flex flex-col items-center">
                    <svg class="w-16 h-16 text-emerald-400 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <p class="text-lg font-semibold text-gray-600">Click or Drag & Drop Image Here</p>
                    <p class="text-sm text-gray-400 mt-2">Supports JPG, PNG, JPEG</p>
                </div>

                <!-- Image Preview -->
                <div id="preview-container" class="hidden mt-4">
                    <img id="preview-image" class="max-h-64 mx-auto rounded-lg shadow-md object-cover" src="" alt="Preview">
                    <button id="remove-image" class="mt-4 px-4 py-2 bg-red-100 text-red-600 rounded-full text-sm font-semibold hover:bg-red-200 transition">Remove Image</button>
                </div>
            </div>

            <!-- Analyze Button -->
            <button id="analyze-btn" class="w-full mt-8 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed hidden">
                Analyze Leaf
            </button>

            <!-- Loading State -->
            <div id="loading" class="hidden mt-8 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto"></div>
                <p class="mt-4 text-emerald-600 font-medium">Analyzing image...</p>
            </div>

            <!-- Result Section -->
            <div id="result-section" class="hidden mt-8 p-6 bg-emerald-50 rounded-xl border border-emerald-100 text-center animate-fade-in">
                <h3 class="text-xl font-bold text-gray-700 mb-2">Detection Result</h3>
                <p id="prediction-text" class="text-3xl font-extrabold text-emerald-700 mb-1">Healthy</p>
                <p id="confidence-text" class="text-sm text-emerald-500 font-medium">Confidence: 98.5%</p>
            </div>

        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-500 text-sm">
            <p>Developed by Sadman Sakib, Abid Chowdhury, Karima Hossain Nowmy</p>
        </div>

    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const uploadPrompt = document.getElementById('upload-prompt');
        const previewContainer = document.getElementById('preview-container');
        const previewImage = document.getElementById('preview-image');
        const removeBtn = document.getElementById('remove-image');
        const analyzeBtn = document.getElementById('analyze-btn');
        const loading = document.getElementById('loading');
        const resultSection = document.getElementById('result-section');
        const predictionText = document.getElementById('prediction-text');
        const confidenceText = document.getElementById('confidence-text');

        let currentFile = null;

        // Drag and Drop handlers
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('bg-emerald-50', 'border-emerald-500');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('bg-emerald-50', 'border-emerald-500');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('bg-emerald-50', 'border-emerald-500');
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        dropZone.addEventListener('click', () => {
            if (!currentFile) fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file.');
                return;
            }
            currentFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                uploadPrompt.classList.add('hidden');
                previewContainer.classList.remove('hidden');
                analyzeBtn.classList.remove('hidden');
                resultSection.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }

        removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            currentFile = null;
            fileInput.value = '';
            previewImage.src = '';
            uploadPrompt.classList.remove('hidden');
            previewContainer.classList.add('hidden');
            analyzeBtn.classList.add('hidden');
            resultSection.classList.add('hidden');
        });

        analyzeBtn.addEventListener('click', async () => {
            if (!currentFile) return;

            loading.classList.remove('hidden');
            analyzeBtn.classList.add('hidden');
            resultSection.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', currentFile);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                } else {
                    predictionText.textContent = data.class;
                    confidenceText.textContent = `Confidence: ${data.confidence.toFixed(2)}%`;
                    
                    // Color coding based on result
                    if (data.class.toLowerCase().includes('healthy')) {
                        predictionText.className = 'text-3xl font-extrabold text-green-600 mb-1';
                    } else {
                        predictionText.className = 'text-3xl font-extrabold text-red-600 mb-1';
                    }
                    
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred during analysis.');
            } finally {
                loading.classList.add('hidden');
                analyzeBtn.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
